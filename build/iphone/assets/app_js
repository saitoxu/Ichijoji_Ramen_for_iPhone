// name space
var app = {};

// connect database
var con = Ti.Database.open('ramen');

// create tab group
var tabGroup = Ti.UI.createTabGroup();

// this sets the background color of the master UIView (when there are no windows/tab groups on it)
Ti.UI.setBackgroundColor('#000');

// Camera
Ti.include('./include/Camera.js');
// Coupon
Ti.include('./include/Coupon.js');
// Database
Ti.include('./include/Database.js');
// Detail
Ti.include('./include/Detail.js');
// Others
Ti.include('./include/Others.js');
// TopList
Ti.include('./include/TopList.js');

// サーバーからラーメン屋の情報を受信
var url = 'http://www8350ui.sakura.ne.jp/ramen.json';

if (Ti.Network.online != false) {
	var xhr = Ti.Network.createHTTPClient();
	xhr.open('GET', url, false);
	xhr.onload = function() {
		var json = JSON.parse(this.responseText);
		// Ti.API.info(json);

		// データベースに追加
		// 2回目以降の処理を加える
		var db = new RamenDatabase();
		for (var i = 0; i < json.ichijoji.length; i++) {
			// Ti.API.info(json.ichijoji[i]);
			db.insertRamen(json.ichijoji[i]);
		}
		Ti.API.info("success!");
		Ti.API.info(db.fetchToList());
		db.close();
	}
	xhr.onerror = function(error) {
	};

	xhr.send();
} else {

}

// call objects
var TopListTab = app.topList.createTab();
var OthersTab = app.others.createTab();

// add tabs
tabGroup.addTab(TopListTab);
tabGroup.addTab(OthersTab);

// open tab group
tabGroup.open();
